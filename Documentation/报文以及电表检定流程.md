# 报文以及电表检定流程

  ## 1. 都需要哪些初始化操作(如：标准源的初始化，误差板的初始化)。

- 实验时需进行如下操作：
  1. 标准功率源初始化：
     - 联机判断 
       - 向功率源发送联机指令，示例报文如下所示：
         - `指令：68 01 01 09 15 A0 00 01 BD //PC固定联机指令`
           
           报文解析
           |    结构    | 字节数 | 数据位索引 |   举例    |                说明                |
           | :--------: | :----: | :--------: | :-------: | :--------------------------------: |
           |    帧头    | 1byte  |     0      |   0x68    |              固定格式              |
           |   地址1    | 1byte  |     1      |   0x01    |           数据接收方地址           |
           |   地址2    | 1byte  |     2      |   0x01    |           数据发送方地址           |
           |    长度    | 1byte  |     3      |   0x09    |   数据帧总长度，包括帧头和校验码   |
           |   功能码   | 1byte  |     4      |   0x15    |  功能码，规定0x15为停止或启用功能  |
           | 寄存器地址 | 2bytes |    5-6     | 0xA0 0x00 |        PC联机专属寄存器地址        |
           |   数据域   | 1byte  |     7      |   0x01    | 数据域，规定0x01为联机，0x02为脱机 |
           |   校验码   | 1byte  |     8      |   0xBD    |              校验码。              |
       - 调用方法
         - ```csharp
            // namesapce:ZH.ZH3001 
            public int Connect(out string[] FrameAry)
           ```
     - 联机成功以后，功率源会返回对应的数据
       - 返回报文（略）
     - 关源指令
       - 从安全角度考虑，确保起始状态下标准功率源处于关源状态。
       - 默认接线方式三相四线，三相三线接线方式需改变指令中的第一个参数（0x01=>0x02）。
       - 示例报文如下所示：
         - `指令：68 01 01 4B 13 20 0B 01 00 00 00 00 FC 00 00 00 00 FC 00 00 00 00 FC 00 24 9F 00 FC 00 00 00 00 FC 00 12 4F 80 FC 00 00 00 00 FC 00 00 00 00 FC 00 00 00 00 FC 00 24 9F 00 FC 00 00 00 00 FC 00 12 4F 80 FC 00 07 A1 20 FC 00 08 //关源指令`
           - 报文解析
             - 详见下文升降源指令解析
       - 调用方法
         - 详见下文升降源方法
  2. 误差板初始化：
     - 表位联机判断
     - 向指定表位发送联机指令，示例报文如下所示：
       - `指令：68 13 FE 08 09 01 00 ED // 设置表位显示屏（联机）`
         
          报文解析
         |  结构  | 字节数 | 数据位索引 | 举例  |                                   说明                                   |
         | :----: | :----: | :--------: | :---: | :----------------------------------------------------------------------: |
         |  帧头  | 1byte  |     0      | 0x68  |                                 固定格式                                 |
         | 地址1  | 1byte  |     1      | 0x13  |             数据接收方地址，在项目中固定0x13，表示误差计算器             |
         | 地址2  | 1byte  |     2      | 0xFE  |              数据发送方地址，在项目中固定为0xFE，表示上位机              |
         |  长度  | 1byte  |     3      | 0x08  |                      数据帧总长度，包括帧头和校验码                      |
         | 功能码 | 1byte  |     4      | 0x09  | 功能码，规定0x09为联机专属功能码，在联机后设置误差板显示屏显示当前表位号 |
         | 表位号 | 1byte  |     5      | 0x01  |                          表位号，范围0x01-0xFF                           |
         | 数据域 | 1byte  |     6      | 0x00  |                            无意义，用0x00表示                            |
         | 校验码 | 1byte  |     7      | 0xED  |    校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验     |
     - 调用方法
       - ```csharp
         // namesapce:ZH.ZH1113
         public int Connect(byte meterN0, out string[] FrameAry)
         ```
     - 表位成功联机以后，误差板会返回对应的数据
     - 返回报文示例：
       - `返回：68 FE 13 08 89 01 4B 26// 误差板返回报文`
         
         报文解析
         |  结构  | 字节数 | 数据位索引 | 举例  |                               说明                                |
         | :----: | :----: | :--------: | :---: | :---------------------------------------------------------------: |
         |  帧头  | 1byte  |     0      | 0x68  |                             固定格式                              |
         | 地址1  | 1byte  |     1      | 0xFE  |          数据接收方地址，在项目中固定为0xFE，表示上位机           |
         | 地址2  | 1byte  |     2      | 0x13  |         数据发送方地址，在项目中固定0x13，表示误差计算器          |
         |  长度  | 1byte  |     3      | 0x08  |                           数据帧总长度                            |
         | 功能码 | 1byte  |     4      | 0x89  |                   功能码，0x89为联机响应功能码                    |
         | 表位号 | 1byte  |     5      | 0x01  |                              表位号                               |
         | 数据域 | 1byte  |     6      | 0x4B  |        ASCII码，0x4B表示字符“K”即OK，指令成功执行的标识符         |
         | 校验码 | 1byte  |     7      | 0x26  | 校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验 |
  3. （可选）多功能板初始化：
     - 联机判断
       - 向指定端口发送读取版本号指令，示例报文如下所示：
         - `指令：68 01 FE 08 10 30 02 D5 // 读取多功能板版本号指令`
           
            报文解析
           |    结构    | 字节数 | 数据位索引 |   举例    |                               说明                                |
           | :--------: | :----: | :--------: | :-------: | :---------------------------------------------------------------: |
           |    帧头    | 1byte  |     0      |   0x68    |                             固定格式                              |
           |   地址1    | 1byte  |     1      |   0x01    |                          数据接收方地址                           |
           |   地址2    | 1byte  |     2      |   0xFE    |                          数据发送方地址                           |
           |    长度    | 1byte  |     3      |   0x08    |                  数据帧总长度，包括帧头和校验码                   |
           |   功能码   | 1byte  |     4      |   0x10    |                    功能码，规定0x10为读功能码                     |
           | 寄存器地址 | 2bytes |    5-6     | 0x30 0x02 |                         版本号寄存器地址                          |
           |   校验码   | 1byte  |     7      |   0xED    | 校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验 |
       - 多功能板成功联机以后，多功能板会返回对应的数据
         - 返回报文（略，数据域返回6位版本号）
       - 调用方法
         - ```csharp
           // namesapce:ZH.ZH3501
           public int Connect(out string[] FrameAry)
           ```
  
  ---
  
  ## 2. 升源和降源 都需要发什么报文，一般报文都要哪些固定的参数、读标准源的电量需要哪些报文

1. 升源操作：
   - 即功率源升源操作
   - 示例报文如下：
     - `指令：68 01 01 4B 13 20 0B 01 00 01 86 A0 FC 00 00 00 00 FC 00 01 86 A0 FC 00 24 9F 00 FC 00 01 86 A0 FC 00 12 4F 80 FC 00 00 27 10 FC 00 00 00 00 FC 00 00 27 10 FC 00 24 9F 00 FC 00 00 27 10 FC 00 12 4F 80 FC 00 07 A1 20 FC 01 19// 开启三相台电压电流回路自检功能，输出10V 1A`
     
      报文解析
     |    结构     | 字节数 | 数据位索引 |           举例           |                                                   说明                                                   |
     | :---------: | :----: | :--------: | :----------------------: | :------------------------------------------------------------------------------------------------------: |
     |    帧头     | 1byte  |     0      |           0x68           |                                                 固定格式                                                 |
     |    地址1    | 1byte  |     1      |           0x01           |                                              数据接收方地址                                              |
     |    地址2    | 1byte  |     2      |           0x01           |                                              数据发送方地址                                              |
     |    长度     | 1byte  |     3      |           0x4B           |                                      数据帧总长度，包括帧头和校验码                                      |
     |   功能码    | 1byte  |     4      |           0x13           |                                      功能码，规定0x13为写寄存器数据                                      |
     | 寄存器地址  | 2bytes |    5-6     |        0x20 0x0B         |                                      规定0x200B为升源参数寄存器地址                                      |
     |  接线方式   | 1byte  |     7      |           0x01           |                            规定接线方式0x01为三相四线接线方式，0x02为三相三线                            |
     |   A相电压   | 5bytes |    8-12    | 0x00 0x01 0x86 0xA0 0xFC | 规定前4字节为数字部分，最后1位为指数级（0x186A0为100000,0xFC为-4，总表达式值为$100000\times10^{-4}=10$） |
     | A相电压相位 | 5bytes |   13-17    | 0x00 0x00 0x00 0x00 0xFC |                                                 规则同上                                                 |
     |   B相电压   | 5bytes |   18-22    | 0x00 0x01 0x86 0xA0 0xFC |                                                 规则同上                                                 |
     | B相电压相位 | 5bytes |   23-27    | 0x00 0x24 0x9F 0x00 0xFC |                                         规则同上，B相电压相位240                                         |
     |   C相电压   | 5bytes |   28-32    | 0x00 0x01 0x86 0xA0 0xFC |                                                 规则同上                                                 |
     | C相电压相位 | 5bytes |   33-37    | 0x00 0x12 0x4F 0x80 0xFC |                                         规则同上，C相电压相位120                                         |
     |   A相电流   | 5bytes |   38-42    | 0x00 0x00 0x27 0x10 0xFC |                                                 规则同上                                                 |
     | A相电流相位 | 5bytes |   43-47    | 0x00 0x00 0x00 0x00 0xFC |                                                 规则同上                                                 |
     |   B相电流   | 5bytes |   48-52    | 0x00 0x00 0x27 0x10 0xFC |                                                 规则同上                                                 |
     | B相电流相位 | 5bytes |   53-57    | 0x00 0x24 0x9F 0x00 0xFC |                                                 规则同上                                                 |
     |   C相电流   | 5bytes |   58-62    | 0x00 0x00 0x27 0x10 0xFC |                                                 规则同上                                                 |
     | C相电流相位 | 5bytes |   63-67    | 0x00 0x12 0x4F 0x80 0xFC |                                                 规则同上                                                 |
     |    频率     | 5bytes |   68-72    | 0x00 0x07 0xA1 0x20 0xFC |                                                 规则同上                                                 |
     |  升源标志   | 1byte  |     73     |           0x01           |                                        规定0x01为升源，0x00为关源                                        |
     |   校验码    | 1byte  |     74     |           0x19           |                    校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验                     |
   - 调用方法：
     - ```csharp
        // namespace:ZH.ZH3001 
        public int PowerOn(int jxfs, double Ua, double Ub, double Uc, double Ia, double Ib, double Ic, double PhiUa, double PhiUb, double PhiUc, double PhiIa, double PhiIb, double PhiIc, double Freq, int Mode, out string[] FrameAry)
       ```
2. 降源操作：
   - 操作同功率源升源操作
   - 需将报文数据中各相电压电流设置为0，==升源标志设置为0x00。==
   - 报文示例如下：
     - `指令：68 01 01 4B 13 20 0B 01 00 00 00 00 FC 00 00 00 00 FC 00 00 00 00 FC 00 24 9F 00 FC 00 00 00 00 FC 00 12 4F 80 FC 00 00 00 00 FC 00 00 00 00 FC 00 00 00 00 FC 00 24 9F 00 FC 00 00 00 00 FC 00 12 4F 80 FC 00 07 A1 20 FC 00 08 //关源指令`
     - 报文解析（同上）
   - 调用方法同升源操作
3. 电量读取操作：
   - 即读取标准源读数操作
   - 示例报文如下：
     - `指令：68 01 01 08 10 10 00 08 // 读取标准源读数`
       - 报文解析（略）
   - 调用方法：
     - ```csharp
        // namespace:ZH.ZH3001
        public int ReadInstMetricAll(out float[] instValue, out string[] FrameAry)
       ```
   - 读取读数指令发送成功之后，标准源会返回对应的数据
     - 返回报文（略）

---

  ## 3. 基础误差实验启动需要发什么报文,  (是否有准备工作)，读基础误差需要哪些报文，结束要哪些报文

- **脉冲方式需根据实际方案来决定**
- 实验启动需进行如下操作： 
  1. 设置标准表常数以及标准表脉冲方式
     1. 按照常数档位表下发标准表常数
        - 常数档位表 
          | 档位  |  电流区间   |    常数值     | 脉冲频率范围值 |
          | :---: | :---------: | :-----------: | :------------: |
          |   1   |   Ⅰ＜0.1A   | $2\times10^9$ | 0.06k - 36.6k  |
          |   2   | 0.1A≤Ⅰ＜1A  | $2\times10^8$ |  0.6k - 36.6k  |
          |   3   |  1A≤Ⅰ＜10A  | $2\times10^7$ |  0.6k - 36.6k  |
          |   4   | 10A≤Ⅰ＜120A | $2\times10^6$ |   0.6k - 44k   |
     2. 设置标准表常数
        - 报文示例如下：
          - `指令： 68 01 01 1F 13 10 08 30 30 30 31 30 30 30 31 30 30 30 31 00 00 00 00 00 00 00 00 00 00 00 00 15 // 设置标准表常数`
            
             报文解析
            |       结构       | 字节数  | 数据位索引 |                            举例                             |                                  说明                                  |
            | :--------------: | :-----: | :--------: | :---------------------------------------------------------: | :--------------------------------------------------------------------: |
            |       帧头       |  1byte  |     0      |                            0x68                             |                                固定格式                                |
            |      地址1       |  1byte  |     1      |                            0x01                             |                             数据接收方地址                             |
            |      地址2       |  1byte  |     2      |                            0x01                             |                             数据发送方地址                             |
            |       长度       |  1byte  |     3      |                            0x1F                             |                     数据帧总长度，包括帧头和校验码                     |
            |      功能码      |  1byte  |     4      |                            0x10                             |                       功能码，规定0x13为写功能码                       |
            |    寄存器地址    | 2bytes  |    5-6     |                          0x10 0x08                          |               寄存器地址，规定0x1008为标准表当前档位地址               |
            |   A相电压挡位    | 2bytes  |    7-8     |                          0x30 0x30                          | A相电压挡位，单位WR，ASCII码表示，共计4个档位。档位查询详见电流档位表  |
            |   A相电流挡位    | 2bytes  |    9-10    |                          0x30 0x31                          | A相电流挡位，单位WR，ASCII码表示，共计14个档位。档位查询详见电压档位表 |
            |   B相电压挡位    | 2bytes  |   11-12    |                          0x30 0x30                          |                     B相电压挡位，规则同A相电压档位                     |
            |   B相电流挡位    | 2bytes  |   13-14    |                          0x30 0x31                          |                     B相电流挡位，规则同A相电流档位                     |
            |   C相电压挡位    | 2bytes  |   14-16    |                          0x30 0x30                          |                     C相电压挡位，规则同A相电压档位                     |
            |   C相电流挡位    | 2bytes  |   17-18    |                          0x30 0x31                          |                     C相电流挡位，规则同A相电流档位                     |
            | 当前表位的表常数 | 12bytes |   19-30    | 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 |              当前表位的常数，ASCII码，字符串形式(12字节)               |
            |      校验码      |  1byte  |     19     |                            0x15                             |   校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验    |
            
             电压档位查询
            |   电压    | 档位  |
            | :-------: | :---: |
            |  自动档   |  00   |
            |  0v-60v   |  01   |
            | 60v-120v  |  02   |
            | 120v-240v |  03   |
            | 240v-480v |  04   |
            
             电流档位查询
            |       电流       | 档位  |
            | :--------------: | :---: |
            |   0A-0.00625A    |  01   |
            | 0.00625A-0.0125A |  02   |
            |  0.0125A-0.025A  |  03   |
            |   0.025A-0.05A   |  04   |
            |   0.05A-0.125A   |  05   |
            |   0.125A-0.25A   |  06   |
            |    0.25A-0.5A    |  07   |
            |    0.5A-1.25A    |  08   |
        - 调用方法：
          - ```csharp
              // namespace:ZH.ZH311
              public int StdGear2(byte stdCmd, ref ulong stdConst, ref double[] stdUIGear, out string[] FrameAry)
            ```
        - 获取标准表常数指令发送成功之后，标准表会返回对应的数据
          - 返回报文（略）
     3. 设置标准表脉冲方式
        - 报文示例如下：
          - `指令： 68 01 01 09 13 10 0E 31 36// 设置标准表脉冲方式为有功脉冲 `
            
            报文解析
            |    结构    | 字节数 | 数据位索引 |   举例    |                               说明                                |
            | :--------: | :----: | :--------: | :-------: | :---------------------------------------------------------------: |
            |    帧头    | 1byte  |     0      |   0x68    |                             固定格式                              |
            |   地址1    | 1byte  |     1      |   0x01    |                          数据接收方地址                           |
            |   地址2    | 1byte  |     2      |   0x01    |                          数据发送方地址                           |
            |    长度    | 1byte  |     3      |   0x09    |                  数据帧总长度，包括帧头和校验码                   |
            |   功能码   | 1byte  |     4      |   0x13    |                    功能码，规定0x13为写功能码                     |
            | 寄存器地址 | 2bytes |    5-6     | 0x10 0x0E |            寄存器地址，规定0x100E为标准表脉冲方式地址             |
            |  脉冲方式  | 1byte  |     7      |   0x31    |  脉冲方式，ASCII码表示，共计16个方式。类型查询详见脉冲输出类型表  |
            |   校验码   | 1byte  |     8      |   0x36    | 校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验 |
            
            脉冲输出方式类型查询
            |     类型     | 数值标识 |
            | :----------: | :------: |
            |   有功脉冲   |   0x31   |
            |   无功脉冲   |   0x32   |
            |    UA脉冲    |   0x33   |
            |    UB脉冲    |   0x34   |
            |    UC脉冲    |   0x35   |
            |    IA脉冲    |   0x36   |
            |    IB脉冲    |   0x37   |
            |    IC脉冲    |   0x38   |
            |    PA脉冲    |   0x39   |
            |    PB脉冲    |   0x3A   |
            |    PC脉冲    |   0x3B   |
            |    QA脉冲    |   0x3C   |
            |    QB脉冲    |   0x3D   |
            |    QC脉冲    |   0x3E   |
            | 谐波有功脉冲 |   0x3F   |
            | 谐波无功脉冲 |   0x40   |
        - 调用方法：
          - ```csharp
              // namespace:ZH.ZH311
              public int SetPulseType(string pulseType)
            ```
        - 设置标准表脉冲方式指令发送成功之后，标准表会返回对应的数据
        - 返回报文（略）
  2. 误差板设置标准表的常数以及被检表圈数
     1. 设置标准表常数
        - 报文示例如下：
          - `指令：68 13 FE 0E 05 01 00 00 01 38 80 FF FE 5F // 设置标准常数80000`
            
            报文解析
            |     结构     | 字节数 | 数据位索引 |        举例         |                               说明                                |
            | :----------: | :----: | :--------: | :-----------------: | :---------------------------------------------------------------: |
            |     帧头     | 1byte  |     0      |        0x68         |                             固定格式                              |
            |    地址1     | 1byte  |     1      |        0x13         |         数据接收方地址，在项目中固定0x13，表示误差计算器          |
            |    地址2     | 1byte  |     2      |        0xFE         |          数据发送方地址，在项目中固定为0xFE，表示上位机           |
            |     长度     | 1byte  |     3      |        0x0E         |                  数据帧总长度，包括帧头和校验码                   |
            |    功能码    | 1byte  |     4      |        0x05         |               功能码，规定0x05为设置标准常数功能码                |
            |    表位号    | 1byte  |     5      |        0x01         |                              表位号                               |
            | 标准常数类型 | 1byte  |     6      |        0x00         |    规定0x00为标准电能常数；0x01为标准时钟常数（预设500000Hz）     |
            |    常数值    | 4bytes |    7-10    | 0x00 0x01 0x38 0x80 |   放大后的常数值（$8000000\times10^{-2} = 80000 = 0x00013880$）   |
            |   放大倍数   | 2bytes |   11-12    |      0xFF 0xFE      |                           有符号short型                           |
            |    校验码    | 1byte  |     13     |        0x5F         | 校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验 |
        - 调用方法：
          - ```csharp
             // namespace:ZH.ZH1113
             public int SetStandardConstantQs(int enlarge, int Constant, int sdbs, byte bwNum, out string[] FrameAry)
            ```
        - 设置标准表常数设置成功以后，误差板会返回对应的报文
          - 返回报文（略）
     2. 设置被检表圈数
        - 报文示例如下： 
        - `指令： 68 13 FE 12 06 01 00 00 00 04 B0 00 00 00 00 00 02 4E // 设置1号表位被检表常数1200，检定圈数为2圈`
          
             报文解析
          |    结构    | 字节数 | 数据位索引 |        举例         |                                             说明                                              |
          | :--------: | :----: | :--------: | :-----------------: | :-------------------------------------------------------------------------------------------: |
          |    帧头    | 1byte  |     0      |        0x68         |                                           固定格式                                            |
          |   地址1    | 1byte  |     1      |        0x13         |                       数据接收方地址，在项目中固定0x13，表示误差计算器                        |
          |   地址2    | 1byte  |     2      |        0xFE         |                        数据发送方地址，在项目中固定为0xFE，表示上位机                         |
          |    长度    | 1byte  |     3      |        0x12         |                                    数据帧总长度，包括帧头                                     |
          |   功能码   | 1byte  |     4      |        0x06         |                            功能码，规定0x06为设置被检表圈数功能码                             |
          |   表位号   | 1byte  |     5      |        0x01         |                                     表位号，范围0x01-0xFF                                     |
          |    组别    | 1byte  |     6      |        0x00         | 规定0x00-有功；0x01-无功；0x04-日计时时钟频率(默认频率 1Hz)；0x05-需量(默认滑差时间 1 分钟)； |
          | 被检常数值 | 4bytes |    7-10    | 0x00 0x00 0x04 0xB0 |                           被检表常数值，数值已放大（0x04B0 = 1200）                           |
          |  放大系数  | 2bytes |   11-12    |      0x00 0x00      |                                         有符号short型                                         |
          |  检定圈数  | 4bytes |   13-16    | 0x00 0x00 0x00 0x02 |                                           检定圈数                                            |
          |   校验码   | 1byte  |     17     |         4E          |               校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验               |
        - 调用方法：
          - ```csharp
             // namespace:ZH.ZH1113
              public int SetBJConstantQs(int enlarge, int Constant, int fads, int qs, byte bwNum, out string[] FrameAry)
            ```
        - 设置被检表常数设置成功以后，误差板会返回对应的报文
          - 返回报文（略）
  3. 向误差板发送启动指令
     - 报文示例如下： 
       - `指令： 68 13 FE 08 0A 01 00 EE// 启动第 1 表位有功电能误差计算`
         
          报文解析
         |  结构  | 字节数 | 数据位索引 | 举例  |                               说明                                |
         | :----: | :----: | :--------: | :---: | :---------------------------------------------------------------: |
         |  帧头  | 1byte  |     0      | 0x68  |                             固定格式                              |
         | 地址1  | 1byte  |     1      | 0x13  |         数据接收方地址，在项目中固定0x13，表示误差计算器          |
         | 地址2  | 1byte  |     2      | 0xFE  |          数据发送方地址，在项目中固定为0xFE，表示上位机           |
         |  长度  | 1byte  |     3      | 0x08  |                  数据帧总长度，包括帧头和校验码                   |
         | 功能码 | 1byte  |     4      | 0x0A  |                   功能码，规定0x0A为启动功能码                    |
         | 表位号 | 1byte  |     5      | 0x01  |                       表位号，范围0x01-0xFF                       |
         |  组别  | 1byte  |     6      | 0x00  |                  组别，类型查询详见组别类型查询                   |
         | 校验位 | 1byte  |     7      | 0xEE  | 校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验 |
         
          组别类型查询
         |                    组别                     | 数值标识 |
         | :-----------------------------------------: | :------: |
         |            开始计算有功电能误差             |   0x00   |
         |            开始计算无功电能误差             |   0x01   |
         |             开始计算日计时误差              |   0x04   |
         |              开始计算需量误差               |   0x05   |
         |              开始计数有功脉冲               |   0x06   |
         |              开始计数无功脉冲               |   0x07   |
         |            开始计算有功脉冲时长             |   0x08   |
         |            开始计算无功脉冲时长             |   0x09   |
         | 开始测试计算电流柱子的温度（包括 ABC 三相） |   0x1A   |
     - 调用方法：
       - ```csharp
          // namespace:ZH.ZH1113
          public int Start(int start, byte bwNum, out string[] FrameAry)
         ```
     - 误差板启动成功以后，误差板会返回对应的报文
       - 返回报文（略）
  4. 功率源升源
     - 操作（略）
- 停止实验需进行如下操作：
  1. 等待误差板圈数倒计时结束
     - 部分表位会因为一些物理原因（接驳问题或者电表损坏）接收不到脉冲，导致误差板无法正常倒计时。需要人为结束实验。
  2. 向误差板发送计算停止指令  
     - 报文示例如下：
       - `指令： 68 13 FE 08 0B 01 00 EE// 停止第 1 表位有功电能误差计算` 
         
         报文解析
         |  结构  | 字节数 | 数据位索引 | 举例  |                               说明                                |
         | :----: | :----: | :--------: | :---: | :---------------------------------------------------------------: |
         |  帧头  | 1byte  |     0      | 0x68  |                             固定格式                              |
         | 地址1  | 1byte  |     1      | 0x13  |                          数据接收方地址                           |
         | 地址2  | 1byte  |     2      | 0xFE  |                          数据发送方地址                           |
         |  长度  | 1byte  |     3      | 0x08  |                  数据帧总长度，包括帧头和校验码                   |
         | 功能码 | 1byte  |     4      | 0x0B  |                              功能码                               |
         | 表位号 | 1byte  |     5      | 0x01  |                              表位号                               |
         |  组别  | 1byte  |     6      | 0x00  |                  组别，类型查询详见组别类型查询                   |
         | 校验码 | 1byte  |     7      | 0xEE  | 校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验 |
         
         组别类型查询
         |          组别          | 数值标识 |
         | :--------------------: | :------: |
         |  停止计算有功电能误差  |   0x00   |
         |  停止计算无功电能误差  |   0x01   |
         |   停止计算日计时误差   |   0x04   |
         |    停止计算需量误差    |   0x05   |
         |    停止计数有功脉冲    |   0x06   |
         |    停止计数无功脉冲    |   0x07   |
         |  停止计算有功脉冲时长  |   0x08   |
         |  停止计算无功脉冲时长  |   0x09   |
         | 停止计算电流柱子的温度 |   0x1A   |
     - 调用方法：
       - ```csharp
          // namespace:ZH.ZH1113
          public int Stop(int stop, byte bwNum, out string[] FrameAry)
         ```
     - 误差板停止成功以后，误差板会返回对应的报文
       - 返回报文（略）
- 读取误差结果需进行如下操作：
  - 在试验过程中或者试验停止后，向误差板发送读取误差指令
    - 报文示例如下：
      - `指令： 68 13 FE 08 07 01 00 E3// 读取第 1 表位有功电能误差计算结果`
        
         报文解析
        |  结构  | 字节数 | 数据位索引 | 举例  |                               说明                                |
        | :----: | :----: | :--------: | :---: | :---------------------------------------------------------------: |
        |  帧头  | 1byte  |     0      | 0x68  |                             固定格式                              |
        | 地址1  | 1byte  |     1      | 0x13  |                          数据接收方地址                           |
        | 地址2  | 1byte  |     2      | 0xFE  |                          数据发送方地址                           |
        |  长度  | 1byte  |     3      | 0x08  |                  数据帧总长度，包括帧头和校验码                   |
        | 功能码 | 1byte  |     4      | 0x07  |                              功能码                               |
        | 表位号 | 1byte  |     5      | 0x01  |                              表位号                               |
        |  组别  | 1byte  |     6      | 0x00  |                  组别，类型查询详见组别类型查询                   |
        | 校验码 | 1byte  |     7      | 0xE3  | 校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验 |
        
         组别类型查询
        |         组别         | 数值标识 |
        | :------------------: | :------: |
        |         有功         |   0x00   |
        |         无功         |   0x01   |
        |        日计时        |   0x04   |
        |         需量         |   0x05   |
        |    有功脉冲计数值    |   0x06   |
        |    无功脉冲计数值    |   0x07   |
        | 有功启动实验脉冲时长 |   0x08   |
        | 无功启动实验脉冲时长 |   0x09   |
    - 调用方法：
      - ```csharp
         // namespace:ZH.ZH1113
          public int ReadData(int readType, byte bwNum, out string[] OutWcData, out int OutBwNul, out int OutGroup, out int OutWcNul, out string[] FrameAry)
        ```
    - 误差板在收到指令后，会返回对应的报文数据
      - 返回报文示例如下：
        - `指令：68 FE 13 1D 87 01 00 00 00 00 05 00 00 2C 8B 00 00 26 32 00 00 2C AF 00 00 25 79 00 00 2C 9E AD //返回1表位5组有功实验误差 `
          
          报文解析
          |    结构     | 字节数 | 数据位索引 |        举例         |                                                                                                                                             说明                                                                                                                                              |
          | :---------: | :----: | :--------: | :-----------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
          |    帧头     | 1byte  |     0      |        0x68         |                                                                                                                                           固定格式                                                                                                                                            |
          |    地址1    | 1byte  |     1      |        0xFE         |                                                                                                                                        数据接收方地址                                                                                                                                         |
          |    地址2    | 1byte  |     2      |        0x13         |                                                                                                                                        数据发送方地址                                                                                                                                         |
          |    长度     | 1byte  |     3      |        0x1D         |                                                                                                                                数据帧总长度，包括帧头和校验码                                                                                                                                 |
          |   功能码    | 1byte  |     4      |        0x87         |                                                                                                                            功能码，规定0x87为读取计算值返回功能码                                                                                                                             |
          |   表位号    | 1byte  |     5      |        0x01         |                                                                                                                                            表位号                                                                                                                                             |
          |    组别     | 1byte  |     6      |        0x00         |                                                                                                                                组别，类型查询详见组别类型查询                                                                                                                                 |
          |  有效次数   | 4bytes |    7-10    | 0x00 0x00 0x00 0x05 |                                                                          1.当组别=0x06 或者 0x07 时，有效次数始终为 1；2.当组别=0x08 或者 0x09 时，有效次数对应为脉冲时长个数；3.当组别为其他值时，此值为误差个数。                                                                           |
          | 误差值结果1 | 4bytes |   11-14    | 0x00 0x00 0x2C 0x8B |       1.当组别=0x06 或者 0x07 时，此值对应脉冲计数值；2.当组别=0x08 或者 0x09 时，此值对应脉冲时长，扩大了 10000 倍，单位为秒；3.当组别为其他值时，此值对应相应的误差值；扩大了 100000 倍；4.当有效次数等于 5 后，有效次数每加 1，此值就会被误差结果值 2 覆盖掉；(即队列形式存储，FIFO)       |
          | 误差值结果2 | 4bytes |   15-18    | 0x00 0x00 0x26 0x32 | 1.当组别=0x06 或者 0x07 时，此值对应标准电能脉冲累计计数值；2.当组别=0x08 或者 0x09 时，此值对应脉冲时长，扩大了 10000 倍，单位为秒；3.当组别为其他值时，此值对应相应的误差值；扩大了 100000 倍；4.当有效次数等于 5 后，有效次数每加 1，此值就会被误差结果值 3 覆盖掉；(即队列形式存储，FIFO) |
          | 误差值结果3 | 4bytes |   19-22    | 0x00 0x00 0x2C 0xAF |      1.当组别=0x06 或者 0x07 时，此值无意义，用 0填补；2.当组别=0x08 或者 0x09 时，此值对应脉冲时长，扩大了 10000 倍，单位为秒；3.当组别为其他值时，此值对应相应的误差值；扩大了 100000 倍；4.当有效次数等于 5 后，有效次数每加 1，此值就会被误差结果值 4 覆盖掉；(即队列形式存储，FIFO)      |
          | 误差值结果4 | 4bytes |   23-26    | 0x00 0x00 0x25 0x79 |                                                                                                                                规则同误差值结果3，覆盖顺序递推                                                                                                                                |
          | 误差值结果5 | 4bytes |   27-30    | 0x00 0x00 0x2C 0x9E |                                                                                                                                规则同误差值结果3，覆盖顺序递推                                                                                                                                |
          |   校验码    | 1byte  |     31     |        0xAD         |                                                                                                               校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验                                                                                                               |
  
  ---
  
  ## 4. 起动实验和潜动实验需要发什么报文,  (是否有准备工作)，该如何判断这些实验是合格还是不合格，结束要哪些报文。
- **具体脉冲读取方法需根据方案来决定。**
  - 国标（GB/T 17215）等规范明确要求：
    - **潜动判定仅针对有功脉冲**  
    - 无功潜动不纳入计量误差考核（因不涉及电费结算）
- 起动试验
  - 定义：
    - 在规定的起动电流条件下，电能表应能起动并连续记录。应对每个计量方向进行试验。
      | 接入电路方式 | 功率因数 | 各准确度等级下的电能表起动电流 |         |         |
      | :----------: | :------: | :----------------------------: | :-----: | :-----: |
      |              |          |               B                |    C    |    D    |
      |   直接接入   |    1     |            0.04Itr             | 0.04Itr | 0.04Itr |
      | 经互感器接入 |    1     |            0.04Itr             | 0.02Itr | 0.02Itr |
  - 启动试验需进行如下操作：
    1. 设置误差板开启计算有功脉冲
       - 报文（略）
       - 调用方法（见上文，0AH 启动功能，注：组别为开始计数有功/无功脉冲）
    2. 软件设定计时器
    3. 在规程时间倒计时结束后读取误差板结果
       - 报文（略）
       - 调用方法（见上文，07H 读取计算值，注：组别为读取有功/无功脉冲计数）
    4. 停止启动试验
       - 报文（略）
       - 调用方法（见上文，0BH 停止当前功能，注：组别为停止计数有功/无功脉冲）
       - ==如果出现至少一个脉冲，则启动试验合格，否则不合格==
- 潜动试验 
  - 定义：
    - 当电能表加 1.1Unom电压，电流线路无电流时，在规定时间内其测试输出不应产生多于一个的脉冲。
    - **异常电流**：
      - 若电表内部存在漏电（如绝缘缺陷），电压会通过寄生阻抗形成微小电流（μA级），导致误脉冲。
      - 此时电流由**电压施加在非理想绝缘阻抗上**产生，而非负载电流。
  - 潜动试验需进行如下操作：
    1. 设置误差板开启计算无功脉冲
       - 报文（略）
       - 调用方法（见上文，0AH 启动功能，组别为开始计数无功脉冲）
    2. 软件设定计时器
    3. 在规程时间倒计时结束后读取误差板结果
       - 报文（略）
       - 调用方法（见上文，07H 读取计算值，组别为读取有功/无功脉冲计数值）
    4. 停止启动试验
       - 报文（略）
       - 调用方法（见上文，0BH 停止当前功能，组别为停止计数有功/无功脉冲） 
       - ==如果出现至少一个脉冲，则潜动试验不合格；如果在规定的时间内没有产生脉冲，则潜动试验合格==
  
  ---
  
  ## 5. 日计时误差实验的启动、读结果、结束报文
- **根据JJG 596-2012检定规程定义：**
  - 对具有计时功能的电能表 ,在参比条件下,其内部时钟日计时误差 限为 ±0.5s/d.
- 注：软件无需控制精密时基源，时基源会自动发送500kHz的脉冲信号，误差板自动比对被检表秒脉冲。
- 日记时误差试验初始化：
  - 设置误差板标准表时间常数为500kHz（即精密时基源的频率）
    - 报文（略）
    - 调用方法（见上文，误差板 05H 设置标准常数）
  - 设置被检表常数1Hz(秒脉冲，一秒一次)以及被检圈数（由于设定1Hz，所以检定圈数即为试验持续的秒数）
    - 报文（略）
    - 调用方法（见上文，误差板 06H 设置被检常数）
- 日计时误差实验的启动：
  - 向误差板发送日记时误差启动指令
    - 报文（略）
    - 调用方法（见上文，误差板 0AH 启动功能，注：组别为开始日计时误差）
- 日计时误差实验的读取：
  - 读取日计时误差实验结果
    - 报文（略）
    - 调用方法（见上文，误差板 07H 读取计算值，注：组别为读取日计时误差）
- 日记时误差试验的结束：
  - 等待误差板倒计时结束
  - 发送日记时结束指令
    - 报文（略）
    - 调用方法（见上文，误差板 0BH 停止当前功能，注：组别为停止日计时误差）
  
  ---
  
  ## 6. 常数实验的启动、读结果、结束报文
- 根据JJG596-2012检定规程，仪表常数试验有以下几种：
  1. 计读脉冲法
  2. 走字试验法
  3. ==标准表法 （软件采用方法）==
- 常数试验需进行如下操作：
  1. 常数试验初始化：
     1. 读取被检表当前电量
        - RS485通讯读取
          - 操作（略）
     2. 初始化标准表电量
        - 向标准表发送清零当前电量并开始累计 
        - `指令： 68 FE 01 09 13 10 0C 31 C8 // 清零电量并开始电量计量`
          
          报文解析
          |    结构    | 字节数 | 数据位索引 |   举例    |                                       说明                                       |
          | :--------: | :----: | :--------: | :-------: | :------------------------------------------------------------------------------: |
          |    帧头    | 1byte  |     0      |   0x68    |                                     固定格式                                     |
          |   地址1    | 1byte  |     1      |   0xFE    |                                  数据接收方地址                                  |
          |   地址2    | 1byte  |     2      |   0x01    |                                  数据发送方地址                                  |
          |    长度    | 1byte  |     3      |   0x09    |                          数据帧总长度，包括帧头和校验码                          |
          |   功能码   | 1byte  |     4      |   0x13    |                            功能码，规定0x13为写功能码                            |
          | 寄存器地址 | 2bytes |    5-6     | 0x10 0x0C |                   寄存器地址，规定0x100C为启停累计电量功能部分                   |
          |   数据位   | 1byte  |     7      |   0x31    | ASCII码表示，Ascii 0x31 = '1'，启停累计电能标识字符’1’表示清零当前电能并开始累计 |
          |   校验码   | 1byte  |     8      |   0xC8    |        校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验         |
        - 调用方法
          - ```csharp
              // namespace:ZH.ZH311
              public int StartStdEnergy(int startOrStopStd, out string[] FrameAry)
            ```
     3. 向误差板发送常数试验启动指令
        - 报文（略）
        - 调用方法（见上文，误差板 0AH 启动功能，注：组别为开始计数有功脉冲）
  2. 常数数试验：
     1. 台体升源
        - 操作（略）
     2. 软件设置计时器开始计数
        - 操作（略）
     3. 倒计时期间向误差板发送读取有功脉冲指令，同时读取标准表的电量
        1. 向误差板发送读取有功脉冲指令
           - 报文（略）
           - 调用方法（见上文，误差板 07H 读取计算值，注：组别为读取有功脉冲计数值）
        2. 读取标准表电量
           - `指令： 68 FE 01 08 10 10 1F E8 // 读取标准表电能`
             
             报文解析
             |    结构    | 字节数 | 数据位索引 |   举例    |                               说明                                |
             | :--------: | :----: | :--------: | :-------: | :---------------------------------------------------------------: |
             |    帧头    | 1byte  |     0      |   0x68    |                             固定格式                              |
             |   地址1    | 1byte  |     1      |   0xFE    |                          数据接收方地址                           |
             |   地址2    | 1byte  |     2      |   0x01    |                          数据发送方地址                           |
             |    长度    | 1byte  |     3      |   0x08    |                  数据帧总长度，包括帧头和校验码                   |
             |   功能码   | 1byte  |     4      |   0x10    |                    功能码，规定0x10为读功能码                     |
             | 寄存器地址 | 2bytes |    5-6     | 0x10 0x1F |               寄存器地址，规定0x101F为读取电能部分                |
             |   校验码   | 1byte  |     7      |   0xE8    | 校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验 |
           - 调用方法
             - ```csharp
                // namespace:ZH.ZH311
                public int ReadEnergy(out float[] flaEnergy, out string[] FrameAry)
               ```
           - 标准表在收到指令后，会返回对应的报文数据
             - 报文（略）
               
               报文解析
               |     结构      | 字节数 | 数据位索引 |                       举例                        |                               说明                                |
               | :-----------: | :----: | :--------: | :-----------------------------------------------: | :---------------------------------------------------------------: |
               |     帧头      | 1byte  |     0      |                       0x68                        |                             固定格式                              |
               |     地址1     | 1byte  |     1      |                       0x01                        |                          数据接收方地址                           |
               |     地址2     | 1byte  |     2      |                       0xFE                        |                          数据发送方地址                           |
               |     长度      | 1byte  |     3      |                       0xA8                        |                  数据帧总长度，包括帧头和校验码                   |
               |    功能码     | 1byte  |     4      |                       0x90                        |                 功能码，规定0x90为读取返回功能码                  |
               |  寄存器地址   | 2bytes |    5-6     |                     0x10 0x1F                     |               寄存器地址，规定0x101F为读取电能部分                |
               |  A相有功电能  | 10byte |    7-16    | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     A相有功电能，ASCII码表示                      |
               |  A相无功电能  | 10byte |   17-26    | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     A相无功电能，ASCII码表示                      |
               |  A相视在电能  | 10byte |   27-36    | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     A相视在电能，ASCII码表示                      |
               |  B相有功电能  | 10byte |   37-46    | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     B相有功电能，ASCII码表示                      |
               |  B相无功电能  | 10byte |   47-56    | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     B相无功电能，ASCII码表示                      |
               |  B相视在电能  | 10byte |   57-66    | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     B相视在电能，ASCII码表示                      |
               |  C相有功电能  | 10byte |   67-76    | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     C相有功电能，ASCII码表示                      |
               |  C相无功电能  | 10byte |   77-86    | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     C相无功电能，ASCII码表示                      |
               |  C相视在电能  | 10byte |   87-96    | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     C相视在电能，ASCII码表示                      |
               |  总有功电能   | 10byte |   97-106   | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |            总有功电能，ASCII码表示，正向+反向，带符号             |
               |  总无功电能   | 10byte |  107-116   | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |            总无功电能，ASCII码表示，正向+反向，带符号             |
               |  总视在电能   | 10byte |  117-126   | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                      总视在电能，ASCII码表示                      |
               |  总有功电能I  | 10byte |  127-136   | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     总有功电能I，ASCII码表示                      |
               | 总有功电能II  | 10byte |  137-146   | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     总有功电能II，ASCII码表示                     |
               | 总无功电能III | 10byte |  147-156   | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                    总无功电能III，ASCII码表示                     |
               | 总无功电能IV  | 10byte |  157-166   | 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 0x30 |                     总无功电能IV，ASCII码表示                     |
               |    校验码     | 1byte  |    167     |                       0xC8                        | 校验和，CHECKSUM前所有数据（不包含帧头）的异或运算结果，即BCC校验 |
             - 取总有功电能做比较
        3. 按照公式比对
           - $$误差 = \frac{W_{被检表}-W_{标准表}}{W_{标准表}}\times100{\%}$$
           - 注：
             - $W_{标准表} 为标准表有功电能$
             - $W_{被检表} 为被检表的有功电能$
  3. 常数数试验结束： 
     1. 等待计时器停止计数
        - 操作（略）
     2. 向误差板发送停止试验指令
        - 报文（略）
        - 调用方法（见上文，误差板 0BH 停止当前功能，注：组别为停止计数有功脉冲）
     3. （可选）读取误差板结果并计算误差
        - 操作（略）
     4. 台体降源
        - 操作（略）
